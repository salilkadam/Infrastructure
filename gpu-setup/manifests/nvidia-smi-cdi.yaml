apiVersion: v1
kind: Pod
metadata:
  name: nvidia-smi-test-cdi
  labels:
    app: gpu-test
  annotations:
    cdi.k8s.io/device-ids: "nvidia.com/gpu=all"
spec:
  restartPolicy: Never
  nodeSelector:
    kubernetes.io/hostname: gpu-server
  containers:
  - name: smi
    image: nvidia/cuda:12.4.1-runtime-ubuntu22.04
    command: ["bash","-lc","set -e; nvidia-smi || (echo 'nvidia-smi missing'; ldconfig -p | grep -i nvidia || true; sleep 3; exit 1)"]
    resources:
      limits:
        nvidia.com/gpu: 1
